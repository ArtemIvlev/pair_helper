{% extends "base.html" %}

{% block title %}–û–±—Ä–∞—â–µ–Ω–∏–µ #{{ feedback.id }} - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>–û–±—Ä–∞—â–µ–Ω–∏–µ #{{ feedback.id }}</h1>
        <a href="{{ url_for('feedback_list') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </div>

    <div class="row">
        <div class="col-md-8">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">{{ feedback.subject }}</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>–¢–∏–ø:</strong>
                            {% if feedback.feedback_type == 'bug' %}üêõ –û—à–∏–±–∫–∞
                            {% elif feedback.feedback_type == 'feature' %}üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                            {% elif feedback.feedback_type == 'general' %}üí¨ –û–±—â–µ–µ
                            {% else %}üìù –î—Ä—É–≥–æ–µ{% endif %}
                        </div>
                        <div class="col-md-6">
                            <strong>–°—Ç–∞—Ç—É—Å:</strong>
                            {% if feedback.status == 'NEW' or not feedback.status %}
                                <span class="badge bg-warning">–ù–æ–≤–æ–µ</span>
                            {% elif feedback.status == 'IN_PROGRESS' %}
                                <span class="badge bg-info">–í —Ä–∞–±–æ—Ç–µ</span>
                            {% elif feedback.status == 'RESOLVED' %}
                                <span class="badge bg-success">–†–µ—à–µ–Ω–æ</span>
                            {% elif feedback.status == 'CLOSED' %}
                                <span class="badge bg-secondary">–ó–∞–∫—Ä—ã—Ç–æ</span>
                            {% else %}
                                <span class="badge bg-warning">–ù–æ–≤–æ–µ</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong>
                        <div class="mt-2 p-3 bg-light rounded">
                            {{ feedback.message | replace('\n', '<br>') | safe }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong><br>
                            {{ feedback.created_at.strftime('%d.%m.%Y %H:%M:%S') }}
                        </div>
                        <div class="col-md-6">
                            <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong><br>
                            {{ feedback.updated_at.strftime('%d.%m.%Y %H:%M:%S') }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>–ò–º—è:</strong><br>
                            {{ feedback.user.first_name }}
                            {% if feedback.user.last_name %}{{ feedback.user.last_name }}{% endif %}
                        </div>
                        <div class="col-md-6">
                            <strong>Telegram ID:</strong><br>
                            {{ feedback.user.telegram_id }}
                        </div>
                    </div>
                    {% if feedback.user.username %}
                    <div class="row mt-2">
                        <div class="col-md-6">
                            <strong>Username:</strong><br>
                            @{{ feedback.user.username }}
                        </div>
                        <div class="col-md-6">
                            <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong><br>
                            {{ feedback.user.created_at.strftime('%d.%m.%Y %H:%M') }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">–î–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('feedback_update', feedback_id=feedback.id) }}">
                        <div class="mb-3">
                            <label for="status" class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</label>
                            <select name="status" id="status" class="form-select">
                                <option value="new" {% if feedback.status == 'NEW' or not feedback.status %}selected{% endif %}>–ù–æ–≤–æ–µ</option>
                                <option value="in_progress" {% if feedback.status == 'IN_PROGRESS' %}selected{% endif %}>–í —Ä–∞–±–æ—Ç–µ</option>
                                <option value="resolved" {% if feedback.status == 'RESOLVED' %}selected{% endif %}>–†–µ—à–µ–Ω–æ</option>
                                <option value="closed" {% if feedback.status == 'CLOSED' %}selected{% endif %}>–ó–∞–∫—Ä—ã—Ç–æ</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="admin_response" class="form-label">–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                            <textarea name="admin_response" id="admin_response" class="form-control" rows="6" 
                                      placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é...">{{ feedback.admin_response or '' }}</textarea>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    </form>

                    <form method="POST" action="{{ url_for('feedback_delete', feedback_id=feedback.id) }}" 
                          onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ?')">
                        <button type="submit" class="btn btn-danger w-100">–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</button>
                    </form>
                </div>
            </div>

            <!-- –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            {% if feedback.admin_response %}
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</h5>
                </div>
                <div class="card-body">
                    <div class="p-3 bg-light rounded">
                        {{ feedback.admin_response | replace('\n', '<br>') | safe }}
                    </div>
                    <small class="text-muted mt-2 d-block">
                        –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ feedback.updated_at.strftime('%d.%m.%Y %H:%M') }}
                    </small>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
