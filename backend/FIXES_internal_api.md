# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º API

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—à–∏–±–∫–∞ SQL JOIN
**–ü—Ä–æ–±–ª–µ–º–∞**: SQLAlchemy –Ω–µ –º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å JOIN –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
```
ERROR: Don't know how to join to <Mapper at 0x7f87e1fa3590; PairDailyQuestion>
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ —É—Å–ª–æ–≤–∏—è JOIN
```python
# –ë—ã–ª–æ:
question_answers = db.query(UserAnswer).join(PairDailyQuestion).filter(...)

# –°—Ç–∞–ª–æ:
question_answers = db.query(UserAnswer).join(
    PairDailyQuestion, 
    UserAnswer.question_id == PairDailyQuestion.question_id
).filter(...)
```

### 2. –û—à–∏–±–∫–∞ —Å NoneType –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
**–ü—Ä–æ–±–ª–µ–º–∞**: UsageAnalyticsMiddleware –ø—ã—Ç–∞–ª—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ API
```
ERROR: 'NoneType' object is not subscriptable
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–∫–ª—é—á–∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ API –∏–∑ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```python
# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ API - –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
if request.url.path.startswith("/api/v1/internal"):
    return await call_next(request)
```

### 3. –û—à–∏–±–∫–∞ —Å None –≤ —Ç–µ–∫—Å—Ç–∞—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—è `text` –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å `None`
```
TypeError: 'NoneType' object is not subscriptable
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `None` –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π

#### –î–ª—è –æ–±—ã—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:
```python
# –ë—ã–ª–æ:
title=f"–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: {answer.question.text[:50]}...",

# –°—Ç–∞–ª–æ:
question_text = answer.question.text or "–í–æ–ø—Ä–æ—Å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞"
title=f"–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: {question_text[:50]}...",
```

#### –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```python
# –ë—ã–ª–æ:
title=f"–°–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞: {answer.question.text[:50]}...",

# –°—Ç–∞–ª–æ:
question_text = answer.question.text or "–í–æ–ø—Ä–æ—Å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞"
title=f"–°–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞: {question_text[:50]}...",
```

#### –î–ª—è —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è:
```python
# –ë—ã–ª–æ:
title=f"–°–æ–±—ã—Ç–∏–µ: {event.title}",
description=f"{event.description or '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}{user_text}",

# –°—Ç–∞–ª–æ:
event_title = event.title or "–°–æ–±—ã—Ç–∏–µ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
event_description = event.description or "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è"
title=f"–°–æ–±—ã—Ç–∏–µ: {event_title}",
description=f"{event_description}{user_text}",
```

#### –î–ª—è —Ä–∏—Ç—É–∞–ª–æ–≤:
```python
# –ë—ã–ª–æ:
title=f"–†–∏—Ç—É–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω: {check.ritual.title}",
description=f"{check_user.first_name} –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–∏—Ç—É–∞–ª '{check.ritual.title}'",

# –°—Ç–∞–ª–æ:
ritual_title = check.ritual.title or "–†–∏—Ç—É–∞–ª –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
title=f"–†–∏—Ç—É–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω: {ritual_title}",
description=f"{check_user.first_name} –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–∏—Ç—É–∞–ª '{ritual_title}'",
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**
‚úÖ **API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ**
‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–æ–∫**

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –ø–æ —Å–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–µ
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—á–µ—Ç –ø–æ —Å–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª –æ—Ç–≤–µ—Ç—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–ª –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
```
–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
```

**–†–µ—à–µ–Ω–∏–µ**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
```python
# –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏ –¥–∞—Ç–∞–º
tune_answers_by_question = {}

# –§–æ—Ä–º–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
# "–ê–Ω–Ω–∞ –æ —Å–µ–±–µ: –æ—Ç–≤–µ—Ç | –ò–≤–∞–Ω –¥—É–º–∞–ª –æ–± –ê–Ω–Ω–µ: –æ—Ç–≤–µ—Ç | –ò–≤–∞–Ω –æ —Å–µ–±–µ: –æ—Ç–≤–µ—Ç | –ê–Ω–Ω–∞ –¥—É–º–∞–ª–∞ –æ–± –ò–≤–∞–Ω–µ: –æ—Ç–≤–µ—Ç"
```

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞**:
```
üéµ –°–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞: –í–æ–ø—Ä–æ—Å –æ —Ç–æ–º, –∫–∞–∫ –º—ã –ø—Ä–æ–≤–æ–¥–∏–º –≤—Ä–µ–º—è –≤–º–µ—Å—Ç–µ...
   –û—Ç–≤–µ—Ç—ã:
     ‚Ä¢ –ê–Ω–Ω–∞ –æ —Å–µ–±–µ: –õ—é–±–ª—é –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤—Ä–µ–º—è –¥–æ–º–∞
     ‚Ä¢ –ò–≤–∞–Ω –¥—É–º–∞–ª –æ–± –ê–Ω–Ω–µ: –î—É–º–∞—é, –æ–Ω–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö
     ‚Ä¢ –ò–≤–∞–Ω –æ —Å–µ–±–µ: –ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å
     ‚Ä¢ –ê–Ω–Ω–∞ –¥—É–º–∞–ª–∞ –æ–± –ò–≤–∞–Ω–µ: –û–Ω –ª—é–±–∏—Ç —Å–ø–æ–∫–æ–π–Ω—ã–π –æ—Ç–¥—ã—Ö
```

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ MCQ
**–ü—Ä–æ–±–ª–µ–º–∞**: –î–ª—è MCQ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
```
"–ê—Ä—Ç—ë–º –æ —Å–µ–±–µ: 0 | Anna –¥—É–º–∞–ª –æ –ê—Ä—Ç—ë–º: 0"
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
```python
def get_answer_text(answer):
    if answer.answer_text and answer.answer_text.strip():
        return answer.answer_text
    elif answer.selected_option is not None and question.question_type == "mcq":
        # –î–ª—è MCQ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞
        options = [question.option1, question.option2, question.option3, question.option4]
        if 0 <= answer.selected_option < len(options) and options[answer.selected_option]:
            return options[answer.selected_option]
        else:
            return f"–í–∞—Ä–∏–∞–Ω—Ç {answer.selected_option + 1}"
    else:
        return "–û—Ç–≤–µ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–µ–∫—Å—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –≤–º–µ—Å—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
```
"–ê—Ä—Ç—ë–º –æ —Å–µ–±–µ: –õ—é–±–ª—é –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤—Ä–µ–º—è –¥–æ–º–∞ | Anna –¥—É–º–∞–ª –æ –ê—Ä—Ç—ë–º: –î—É–º–∞—é, –æ–Ω –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö"
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

API —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
- –ó–∞–ø—Ä–æ—Å—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–∏
- –ó–∞–ø—Ä–æ—Å—ã —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–∏ (404)
- –ó–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–≤–µ—Ä–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞—Ç—ã (400)
- –î–∞–Ω–Ω—ã–µ —Å –ø—É—Å—Ç—ã–º–∏/–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **–ü—Ä–∞–≤–∏–ª—å–Ω—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –æ—Ç–≤–µ—Ç–æ–≤ —Å–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ MCQ –æ—Ç–≤–µ—Ç–æ–≤**
