# Внутренний API для получения активности пары за неделю

## Что было реализовано

Создан новый внутренний API endpoint для получения всей активности пары за неделю в человекочитаемом формате. API доступен только с локальных адресов и внутренних сетей, не требует аутентификации Telegram.

### Основные компоненты

1. **Новые схемы данных** (`app/schemas/pair.py`):
   - `PairActivityItem` - элемент активности
   - `PairWeeklyActivity` - полный ответ с активностью за неделю

2. **Новый внутренний API endpoint** (`app/api/api_v1/endpoints/internal.py`):
   - `GET /api/v1/internal/pair/{pair_id}/weekly-activity` - получение активности за неделю

3. **Документация** (`docs/weekly_activity_api.md`):
   - Полное описание внутреннего API
   - Примеры использования
   - Структура ответа
   - Информация о безопасности

4. **Middleware безопасности** (`app/middleware/internal_api.py`):
   - Защита от внешнего доступа
   - Проверка IP адресов
   - Логирование попыток доступа

5. **Тестовые скрипты**:
   - `test_weekly_activity.py` - простой тест внутреннего API
   - `example_weekly_activity.py` - пример использования с форматированием

## Функциональность

API собирает и возвращает следующие типы активности:

1. **Настроения** (Mood) - с переводом на русский язык
2. **Благодарности** (Appreciation)
3. **Ритуалы** (Ritual) - только выполненные
4. **События календаря** (CalendarEvent)
5. **Эмоциональные заметки** (EmotionNote)
6. **Ответы на вопросы** (UserAnswer + PairDailyQuestion)
7. **Ответы на сонастройку** (TuneAnswer + PairDailyTuneQuestion)

## Особенности реализации

- Все активности сортируются по времени
- Автоматическая генерация сводки
- Человекочитаемые названия настроений
- Указание владельца для событий календаря
- Различение "о себе" и "о партнере" в сонастройке
- Обработка ошибок и валидация входных данных

## Использование

```bash
# Пример запроса (только с локального адреса)
curl -X GET "http://localhost:8000/api/v1/internal/pair/1/weekly-activity?week_start=2024-01-15"
```

## Тестирование

```bash
# Запуск тестового скрипта
python3 test_weekly_activity.py

# Запуск примера с форматированием
python3 example_weekly_activity.py
```

## Структура ответа

```json
{
  "pair_id": 1,
  "user1_name": "Анна",
  "user2_name": "Иван", 
  "week_start": "2024-01-15",
  "week_end": "2024-01-21",
  "summary": "За неделю: 3 настроения, 2 благодарности, 1 выполненный ритуал",
  "activities": [
    {
      "date": "2024-01-15",
      "type": "mood",
      "title": "Настроение: радостное",
      "description": "Анна отметил настроение как радостное",
      "user_name": "Анна",
      "timestamp": "2024-01-15T10:30:00"
    }
  ]
}
```

## Безопасность

- Доступ разрешен только с локальных адресов и внутренних сетей
- Проверка IP адреса через middleware
- Проверка существования активной пары
- Валидация формата даты
- Логирование всех попыток доступа
- Не требует аутентификации Telegram
