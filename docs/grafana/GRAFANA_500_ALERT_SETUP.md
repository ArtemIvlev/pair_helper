# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana –∞–ª–µ—Ä—Ç–∞ –Ω–∞ HTTP 500 –æ—à–∏–±–∫–∏

## –û–±–∑–æ—Ä
–≠—Ç–æ—Ç –∞–ª–µ—Ä—Ç –±—É–¥–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å HTTP 500 –æ—à–∏–±–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `usage_events` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Grafana

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Alert Rule

1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Alerting** ‚Üí **Alert Rules**
3. –ù–∞–∂–º–∏—Ç–µ **New Alert Rule**

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Query

**Query A:**
```sql
SELECT COUNT(*) as error_count
FROM usage_events 
WHERE status = 500 
  AND ts >= NOW() - INTERVAL '5 minutes'
```

**DataSource:** PostgreSQL (pair_helper_db)
**Query Type:** SQL

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alert Rule

- **Name:** HTTP 500 Errors Alert
- **For:** 1m (–∞–ª–µ—Ä—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ 1 –º–∏–Ω—É—Ç—ã)
- **Condition:** `A > 1` (–±–æ–ª—å—à–µ 1 –æ—à–∏–±–∫–∏ –∑–∞ 5 –º–∏–Ω—É—Ç)

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
1. –í **Contact points** —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π contact point
2. **Type:** Telegram
3. **Bot Token:** –í–∞—à Telegram bot token
4. **Chat ID:** ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
5. **Message Template:**
```
üö® HTTP 500 Errors detected!

Route: {{ .Route }}
Count: {{ .Count }}
Time: {{ .Time }}

Check logs immediately!
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ Dashboard

–°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ —Å –ø–∞–Ω–µ–ª—è–º–∏:

#### –ü–∞–Ω–µ–ª—å 1: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ 500
```sql
SELECT COUNT(*) as error_count
FROM usage_events 
WHERE status = 500 
  AND ts >= NOW() - INTERVAL '5 minutes'
```

#### –ü–∞–Ω–µ–ª—å 2: –û—à–∏–±–∫–∏ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º
```sql
SELECT 
    route,
    COUNT(*) as error_count
FROM usage_events 
WHERE status = 500 
  AND ts >= NOW() - INTERVAL '1 hour'
GROUP BY route 
ORDER BY error_count DESC 
LIMIT 10
```

#### –ü–∞–Ω–µ–ª—å 3: –ì—Ä–∞—Ñ–∏–∫ –æ—à–∏–±–æ–∫
```sql
SELECT 
    DATE_TRUNC('minute', ts) as time_bucket,
    COUNT(*) as error_count
FROM usage_events 
WHERE status = 500 
  AND ts >= NOW() - INTERVAL '1 hour'
GROUP BY DATE_TRUNC('minute', ts)
ORDER BY time_bucket
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º** - –∞–ª–µ—Ä—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É  
‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫  
‚úÖ **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —á–∞—Ç  
‚úÖ **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤  

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤

- **Warning:** > 1 –æ—à–∏–±–∫–∞ –∑–∞ 5 –º–∏–Ω—É—Ç
- **Critical:** > 5 –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç
- **Emergency:** > 10 –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–µ—Ä—Ç–∞ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ:
- –û—à–∏–±–∫–∞—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –û—à–∏–±–∫–∞—Ö API endpoints
- –õ—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö HTTP 500 –æ—à–∏–±–∫–∞—Ö
