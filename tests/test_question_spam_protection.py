#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞ –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö
"""

import requests
import time
import json
from datetime import datetime

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BASE_URL = "http://192.168.2.228:8000"
API_BASE = f"{BASE_URL}/api/v1"

def test_question_spam_protection():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞—â–∏—Ç—É –æ—Ç —Å–ø–∞–º–∞ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤"""
    
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞—â–∏—Ç—É –æ—Ç —Å–ø–∞–º–∞ –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö...")
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ)
    test_user_token = "your_test_token_here"  # –ù—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    headers = {
        "Authorization": f"Bearer {test_user_token}",
        "Content-Type": "application/json"
    }
    
    # –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å - –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ
    print("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...")
    try:
        response = requests.post(
            f"{API_BASE}/questions/notify_partner",
            headers=headers
        )
        
        if response.status_code == 200:
            print("‚úÖ –ü–µ—Ä–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ")
        elif response.status_code == 400:
            print(f"‚ö†Ô∏è –ü–µ—Ä–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: {response.json().get('detail', '–û—à–∏–±–∫–∞')}")
        else:
            print(f"‚ùå –ü–µ—Ä–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: {response.status_code} - {response.text}")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏: {e}")
    
    # –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    print("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)...")
    try:
        response = requests.post(
            f"{API_BASE}/questions/notify_partner",
            headers=headers
        )
        
        if response.status_code == 429:
            detail = response.json().get('detail', '')
            print(f"‚úÖ –í—Ç–æ—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: {detail}")
        elif response.status_code == 200:
            print("‚ö†Ô∏è –í—Ç–æ—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–∞—Ä—Ç–Ω—ë—Ä —É–∂–µ –æ—Ç–≤–µ—Ç–∏–ª)")
        else:
            print(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: {response.status_code} - {response.text}")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ç–æ—Ä–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏: {e}")
    
    print("\nüìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...")
    print("üí° –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞—Ä–æ–π")

if __name__ == "__main__":
    test_question_spam_protection()
